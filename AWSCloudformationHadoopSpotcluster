{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Creates a VPC with Managed NAT, similar to the VPC Wizard at https://console.aws.amazon.com/vpc/home#wizardFullpagePublicAndPrivate: (extended from VPC_with_PublicIPs_And_DNS.template sample)",
    "Metadata": {
        "AWS::CloudFormation::Interface": {
            "ParameterGroups": [
                {
                    "Label": {
                        "default": "Centrica Stack Network Configurations"
                    },
                    "Parameters": [
                        "pCentricaVPCCIDR"
                    ]
                },
                {
                    "Label": {
                        "default": "Centrica Management Stack Configurations"
                    },
                    "Parameters": [
                        "pManagementSubnetCIDRAZ1",
                        "pManagementSubnetCIDRAZ2",
                        "pBastionKeyName",
                        "pBastionInstanceType",
                        "pBastionAMIid",
                        "pMasterport",
                        "pRDPLocation"
                    ]
                },
                {
                    "Label": {
                        "default": "Centrica WebLayer Stack Configurations"
                    },
                    "Parameters": [
                        "pPrivateWebSubnetCIDRAZ1",
                        "pPrivateWebSubnetCIDRAZ2",
                        "pWebServerInstanceType",
                        "pWebServerAMIid",
                        "pWebServerKeyName",
                        "pRDPLocation"
                    ]
                },
                {
                    "Label": {
                        "default": "Centrica Spot Instance Bid details"
                    },
                    "Parameters": [
                        "pSpotPrice",
                        "pClusterSize"
                    ]
                }
            ],
            "ParameterLabels": {
                "pCentricaVPCCIDR": {
                    "default": "IP Range for VPC "
                },
                "pManagementSubnetCIDRAZ1": {
                    "default": "Subnet CIDR for AZ1"
                },
                "pManagementSubnetCIDRAZ2": {
                    "default": "Subnet CIDR for AZ2"
                },
                "pBastionKeyName": {
                    "default": "Security Key for SSH access"
                },
                "pBastionInstanceType": {
                    "default": "Bastion's Server type"
                },
                "pBastionAMIid": {
                    "default": "AWS Image AMI ID"
                },
                "pRDPLocation": {
                    "default": "RDP Location"
                },
                "pMasterport": {
                    "default": "Hadoop Master TCP/IP port "
                },
                "pPrivateWebSubnetCIDRAZ1": {
                    "default": "Subnet CIDR for AZ1"
                },
                "pPrivateWebSubnetCIDRAZ2": {
                    "default": "Subnet CIDR for AZ2"
                },
                "pWebServerInstanceType": {
                    "default": "Server type"
                },
                "pWebServerAMIid": {
                    "default": "AWS Image AMI ID"
                },
                "pWebServerKeyName": {
                    "default": "Security Key for SSH access"
                },
                "pSpotInstancedetails": {
                    "default": "Bid Price"
                },
                "pBucketName": {
                    "default": "Centrica S3Bucket Name"
                }
            }
        },
        "AWS::CloudFormation::Designer": {
            "69047e79-d274-47e8-9428-7c3e9d694a75": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 140,
                    "y": 1010
                },
                "z": 2,
                "parent": "44efd435-2259-4c6e-986c-4a3e2e1e7a38",
                "embeds": []
            },
            "d5d3ebe5-2659-4545-9d70-a0f53f4d14a6": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 710,
                    "y": 0
                },
                "z": 1,
                "embeds": []
            },
            "a1849f4f-1fbd-47c4-9f24-d91bdafc9a55": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 1210,
                    "y": 330
                },
                "z": 1,
                "embeds": []
            },
            "44efd435-2259-4c6e-986c-4a3e2e1e7a38": {
                "size": {
                    "width": 1050,
                    "height": 1050
                },
                "position": {
                    "x": 60,
                    "y": 90
                },
                "z": 1,
                "embeds": [
                    "6cbf2456-360d-4b76-a1f2-e43e76beaf78",
                    "ff65eadf-46f2-4d51-a0e4-e5a5fbdec593",
                    "3c2804fd-0f9c-42a2-98f0-b777a77b32ad",
                    "b10a1362-1f9e-40fb-83f8-bfc6e447ff1f",
                    "9a01720a-66ac-462b-bc9c-391f7ecf749c",
                    "0861c8d3-5aab-480d-a16e-d061516dae54",
                    "d499f116-9a15-4ffe-9611-89cb8a0e8f60",
                    "39e32367-dc13-4ac5-b351-2dbcdd330dd5",
                    "909e6c57-0309-4f09-a39c-7e00ecae87b9",
                    "69047e79-d274-47e8-9428-7c3e9d694a75"
                ]
            },
            "6cbf2456-360d-4b76-a1f2-e43e76beaf78": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 390,
                    "y": 960
                },
                "z": 2,
                "parent": "44efd435-2259-4c6e-986c-4a3e2e1e7a38",
                "embeds": [],
                "iscontainedinside": [
                    "44efd435-2259-4c6e-986c-4a3e2e1e7a38"
                ]
            },
            "7ed01856-456b-48d0-9cf8-aa7dcb800d0d": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 520,
                    "y": 680
                },
                "z": 3,
                "parent": "0861c8d3-5aab-480d-a16e-d061516dae54",
                "embeds": [],
                "isassociatedwith": [
                    "6cbf2456-360d-4b76-a1f2-e43e76beaf78"
                ]
            },
            "ff8e7759-a16f-41ab-9c0e-d5a392110dd3": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 200,
                    "y": 730
                },
                "z": 3,
                "parent": "d499f116-9a15-4ffe-9611-89cb8a0e8f60",
                "embeds": [],
                "isassociatedwith": [
                    "6cbf2456-360d-4b76-a1f2-e43e76beaf78"
                ]
            },
            "ff65eadf-46f2-4d51-a0e4-e5a5fbdec593": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 330,
                    "y": 500
                },
                "z": 2,
                "parent": "44efd435-2259-4c6e-986c-4a3e2e1e7a38",
                "embeds": [],
                "iscontainedinside": [
                    "44efd435-2259-4c6e-986c-4a3e2e1e7a38"
                ]
            },
            "3c2804fd-0f9c-42a2-98f0-b777a77b32ad": {
                "size": {
                    "width": 240,
                    "height": 240
                },
                "position": {
                    "x": 800,
                    "y": 480
                },
                "z": 2,
                "parent": "44efd435-2259-4c6e-986c-4a3e2e1e7a38",
                "embeds": [
                    "55c8f98e-4caa-4519-ac58-f653124a4089"
                ],
                "iscontainedinside": [
                    "44efd435-2259-4c6e-986c-4a3e2e1e7a38"
                ]
            },
            "b10a1362-1f9e-40fb-83f8-bfc6e447ff1f": {
                "size": {
                    "width": 330,
                    "height": 240
                },
                "position": {
                    "x": 760,
                    "y": 780
                },
                "z": 2,
                "parent": "44efd435-2259-4c6e-986c-4a3e2e1e7a38",
                "embeds": [
                    "0bd26bb5-d9b2-46c0-8e63-fc8dcbd53953",
                    "5c78b6a0-ee39-4b7f-97d3-96df1688f4cc"
                ],
                "iscontainedinside": [
                    "44efd435-2259-4c6e-986c-4a3e2e1e7a38"
                ]
            },
            "0bd26bb5-d9b2-46c0-8e63-fc8dcbd53953": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 790,
                    "y": 840
                },
                "z": 3,
                "parent": "b10a1362-1f9e-40fb-83f8-bfc6e447ff1f",
                "embeds": [],
                "iscontainedinside": [
                    "b10a1362-1f9e-40fb-83f8-bfc6e447ff1f"
                ]
            },
            "5c78b6a0-ee39-4b7f-97d3-96df1688f4cc": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 910,
                    "y": 840
                },
                "z": 3,
                "parent": "b10a1362-1f9e-40fb-83f8-bfc6e447ff1f",
                "embeds": [],
                "iscontainedinside": [
                    "b10a1362-1f9e-40fb-83f8-bfc6e447ff1f"
                ]
            },
            "9a01720a-66ac-462b-bc9c-391f7ecf749c": {
                "size": {
                    "width": 240,
                    "height": 240
                },
                "position": {
                    "x": 790,
                    "y": 150
                },
                "z": 2,
                "parent": "44efd435-2259-4c6e-986c-4a3e2e1e7a38",
                "embeds": [
                    "194e767c-f52b-43ef-b236-f41c59f2c4ca"
                ],
                "iscontainedinside": [
                    "44efd435-2259-4c6e-986c-4a3e2e1e7a38"
                ]
            },
            "a0a05751-f344-4423-b6fe-b5833fb2360f": {
                "source": {
                    "id": "44efd435-2259-4c6e-986c-4a3e2e1e7a38"
                },
                "target": {
                    "id": "a1849f4f-1fbd-47c4-9f24-d91bdafc9a55"
                }
            },
            "194e767c-f52b-43ef-b236-f41c59f2c4ca": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 820,
                    "y": 210
                },
                "z": 3,
                "parent": "9a01720a-66ac-462b-bc9c-391f7ecf749c",
                "embeds": [],
                "isassociatedwith": [
                    "a1849f4f-1fbd-47c4-9f24-d91bdafc9a55"
                ],
                "iscontainedinside": [
                    "9a01720a-66ac-462b-bc9c-391f7ecf749c"
                ],
                "dependson": [
                    "a0a05751-f344-4423-b6fe-b5833fb2360f"
                ]
            },
            "0861c8d3-5aab-480d-a16e-d061516dae54": {
                "size": {
                    "width": 240,
                    "height": 240
                },
                "position": {
                    "x": 400,
                    "y": 610
                },
                "z": 2,
                "parent": "44efd435-2259-4c6e-986c-4a3e2e1e7a38",
                "embeds": [
                    "8d50543b-e0de-4d77-a1b7-d3106890ae41",
                    "7ed01856-456b-48d0-9cf8-aa7dcb800d0d"
                ],
                "iscontainedinside": [
                    "44efd435-2259-4c6e-986c-4a3e2e1e7a38"
                ]
            },
            "8d50543b-e0de-4d77-a1b7-d3106890ae41": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 430,
                    "y": 670
                },
                "z": 3,
                "parent": "0861c8d3-5aab-480d-a16e-d061516dae54",
                "embeds": [],
                "isassociatedwith": [
                    "7ed01856-456b-48d0-9cf8-aa7dcb800d0d"
                ],
                "iscontainedinside": [
                    "0861c8d3-5aab-480d-a16e-d061516dae54"
                ]
            },
            "fd8d23df-4577-4742-8372-5cdaefc709f3": {
                "source": {
                    "id": "3c2804fd-0f9c-42a2-98f0-b777a77b32ad"
                },
                "target": {
                    "id": "0861c8d3-5aab-480d-a16e-d061516dae54"
                }
            },
            "d499f116-9a15-4ffe-9611-89cb8a0e8f60": {
                "size": {
                    "width": 240,
                    "height": 240
                },
                "position": {
                    "x": 100,
                    "y": 600
                },
                "z": 2,
                "parent": "44efd435-2259-4c6e-986c-4a3e2e1e7a38",
                "embeds": [
                    "7fe820b8-4872-4e65-867f-f5121511bf1b",
                    "ff8e7759-a16f-41ab-9c0e-d5a392110dd3"
                ],
                "iscontainedinside": [
                    "44efd435-2259-4c6e-986c-4a3e2e1e7a38"
                ]
            },
            "7fe820b8-4872-4e65-867f-f5121511bf1b": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 130,
                    "y": 660
                },
                "z": 3,
                "parent": "d499f116-9a15-4ffe-9611-89cb8a0e8f60",
                "embeds": [],
                "isassociatedwith": [
                    "ff8e7759-a16f-41ab-9c0e-d5a392110dd3"
                ],
                "iscontainedinside": [
                    "d499f116-9a15-4ffe-9611-89cb8a0e8f60"
                ]
            },
            "82db69c9-b73b-4d6a-868b-fbf8d558a97b": {
                "source": {
                    "id": "3c2804fd-0f9c-42a2-98f0-b777a77b32ad"
                },
                "target": {
                    "id": "d499f116-9a15-4ffe-9611-89cb8a0e8f60"
                }
            },
            "39e32367-dc13-4ac5-b351-2dbcdd330dd5": {
                "size": {
                    "width": 240,
                    "height": 240
                },
                "position": {
                    "x": 480,
                    "y": 150
                },
                "z": 2,
                "parent": "44efd435-2259-4c6e-986c-4a3e2e1e7a38",
                "embeds": [
                    "5dc23e19-b69c-43d0-96f6-124708677daf"
                ],
                "iscontainedinside": [
                    "44efd435-2259-4c6e-986c-4a3e2e1e7a38"
                ]
            },
            "5dc23e19-b69c-43d0-96f6-124708677daf": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 510,
                    "y": 210
                },
                "z": 3,
                "parent": "39e32367-dc13-4ac5-b351-2dbcdd330dd5",
                "embeds": [],
                "iscontainedinside": [
                    "39e32367-dc13-4ac5-b351-2dbcdd330dd5"
                ]
            },
            "1f90314b-4c02-4191-907e-e14bb2ac6484": {
                "source": {
                    "id": "b10a1362-1f9e-40fb-83f8-bfc6e447ff1f"
                },
                "target": {
                    "id": "39e32367-dc13-4ac5-b351-2dbcdd330dd5"
                }
            },
            "745a0cae-4fd1-4203-b374-4a93f94fb81b": {
                "source": {
                    "id": "9a01720a-66ac-462b-bc9c-391f7ecf749c"
                },
                "target": {
                    "id": "39e32367-dc13-4ac5-b351-2dbcdd330dd5"
                }
            },
            "909e6c57-0309-4f09-a39c-7e00ecae87b9": {
                "size": {
                    "width": 330,
                    "height": 240
                },
                "position": {
                    "x": 90,
                    "y": 150
                },
                "z": 2,
                "parent": "44efd435-2259-4c6e-986c-4a3e2e1e7a38",
                "embeds": [
                    "e9cccca4-fb40-4cb2-8d0c-37fa7b24b166",
                    "524f11c0-1cf7-4b5f-838c-7ef3da15e6f2"
                ],
                "iscontainedinside": [
                    "44efd435-2259-4c6e-986c-4a3e2e1e7a38"
                ]
            },
            "e9cccca4-fb40-4cb2-8d0c-37fa7b24b166": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 120,
                    "y": 210
                },
                "z": 3,
                "parent": "909e6c57-0309-4f09-a39c-7e00ecae87b9",
                "embeds": [],
                "iscontainedinside": [
                    "909e6c57-0309-4f09-a39c-7e00ecae87b9"
                ]
            },
            "d92f7dab-2789-49ce-a13b-b1adc65f7303": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 300,
                    "y": -30
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "e9cccca4-fb40-4cb2-8d0c-37fa7b24b166",
                    "5dc23e19-b69c-43d0-96f6-124708677daf"
                ]
            },
            "524f11c0-1cf7-4b5f-838c-7ef3da15e6f2": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 240,
                    "y": 210
                },
                "z": 3,
                "parent": "909e6c57-0309-4f09-a39c-7e00ecae87b9",
                "embeds": [],
                "iscontainedinside": [
                    "909e6c57-0309-4f09-a39c-7e00ecae87b9"
                ]
            },
            "55c8f98e-4caa-4519-ac58-f653124a4089": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 830,
                    "y": 540
                },
                "z": 3,
                "parent": "3c2804fd-0f9c-42a2-98f0-b777a77b32ad",
                "embeds": [],
                "isassociatedwith": [
                    "524f11c0-1cf7-4b5f-838c-7ef3da15e6f2"
                ],
                "iscontainedinside": [
                    "3c2804fd-0f9c-42a2-98f0-b777a77b32ad"
                ]
            },
            "ece44d20-1834-4ea5-9b0a-ff4b86decc26": {
                "source": {
                    "id": "b10a1362-1f9e-40fb-83f8-bfc6e447ff1f"
                },
                "target": {
                    "id": "909e6c57-0309-4f09-a39c-7e00ecae87b9"
                }
            },
            "b3f5276c-7006-4cf8-a701-0f84df897582": {
                "source": {
                    "id": "9a01720a-66ac-462b-bc9c-391f7ecf749c"
                },
                "target": {
                    "id": "909e6c57-0309-4f09-a39c-7e00ecae87b9"
                }
            }
        }
    },
    "Parameters": {
        "pRDPLocation": {
            "Description": "Lockdown RDP access to the bastion host (default can be accessed from anywhere)",
            "Type": "String",
            "MinLength": "9",
            "MaxLength": "19",
            "Default": "0.0.0.0/0",
            "AllowedPattern": "(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})",
            "ConstraintDescription": "must be a valid CIDR range of the form x.x.x.x/x."
        },
        "pMasterport": {
            "Description": "TCP/IP port of the web server",
            "Type": "String",
            "Default": "8888"
        },
        "pWebServerInstanceType": {
            "Description": "WebServer Server EC2 instance type",
            "Type": "String",
            "Default": "t2.micro"
        },
        "pWebServerKeyName": {
            "Description": "The SSH key pair in your account to use for all other WebServer instance logins",
            "Type": "AWS::EC2::KeyPair::KeyName",
            "Default": "awscoe",
            "ConstraintDescription": "must be the name of an existing EC2 KeyPair."
        },
        "pBastionKeyName": {
            "Description": "The SSH key pair in your account to use for the bastion host login",
            "Type": "AWS::EC2::KeyPair::KeyName",
            "Default": "awscoe",
            "ConstraintDescription": "must be the name of an existing EC2 KeyPair."
        },
        "pBastionInstanceType": {
            "Description": "WebServer Server EC2 instance type",
            "Type": "String",
            "Default": "t2.micro"
        },
        "pWebServerAMIid": {
            "Description": "AMI ID's are region specific use only HVM type",
            "Type": "String"
        },
        "pBastionAMIid": {
            "Description": "AMI ID's are region specific use only HVM type",
            "Type": "String"
        },
        "pCentricaVPCCIDR": {
            "Type": "String",
            "Default": "173.0.0.0/16",
            "Description": "The VPC CidrBlock"
        },
        "pManagementSubnetCIDRAZ1": {
            "Type": "String",
            "Default": "173.0.0.0/24",
            "Description": "The Public SUBnet CidrBlock for NAT in AZ1"
        },
        "pPrivateWebSubnetCIDRAZ1": {
            "Type": "String",
            "Default": "173.0.1.0/24",
            "Description": "The Private SUBnet CidrBlock for Web in AZ1"
        },
        "pManagementSubnetCIDRAZ2": {
            "Type": "String",
            "Default": "173.0.4.0/24",
            "Description": "The Public SUBnet CidrBlock for NAT in AZ2"
        },
        "pPrivateWebSubnetCIDRAZ2": {
            "Type": "String",
            "Default": "173.0.5.0/24",
            "Description": "The Private SUBnet CidrBlock for Web in AZ2"
        },
        "pSpotPrice": {
            "Description": "Maximum spot price to bid in USD (e.g.: 0.32).",
            "Default": "0.1",
            "Type": "Number"
        },
        "pClusterSize": {
            "Default": "3",
            "MinValue": "3",
            "MaxValue": "12",
            "Description": "Number of nodes in cluster (3-12) Ex: if 3 total 6 nodes .",
            "Type": "Number"
        },
        "pBucketName": {
            "Description": "Centrica Hadoop S3 Bucket",
            "Type": "String"
        }
    },
    "Resources": {
        "VPC": {
            "Type": "AWS::EC2::VPC",
            "Properties": {
                "EnableDnsSupport": "true",
                "EnableDnsHostnames": "true",
                "CidrBlock": {
                    "Ref": "pCentricaVPCCIDR"
                },
                "Tags": [
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackName"
                        }
                    },
                    {
                        "Key": "Network",
                        "Value": "Public"
                    },
                    {
                        "Key": "Name",
                        "Value": "VPC Public and Private with NAT"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "44efd435-2259-4c6e-986c-4a3e2e1e7a38"
                }
            }
        },
        "rPublicSubnet1": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "CidrBlock": {
                    "Ref": "pManagementSubnetCIDRAZ1"
                },
                "AvailabilityZone": {
                    "Fn::Select": [
                        "0",
                        {
                            "Fn::GetAZs": ""
                        }
                    ]
                },
                "MapPublicIpOnLaunch": "true",
                "Tags": [
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackName"
                        }
                    },
                    {
                        "Key": "Network",
                        "Value": "Public"
                    },
                    {
                        "Key": "Name",
                        "Value": "Public"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "909e6c57-0309-4f09-a39c-7e00ecae87b9"
                }
            }
        },
        "rPublicSubnet2": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "CidrBlock": {
                    "Ref": "pManagementSubnetCIDRAZ2"
                },
                "AvailabilityZone": {
                    "Fn::Select": [
                        "1",
                        {
                            "Fn::GetAZs": ""
                        }
                    ]
                },
                "MapPublicIpOnLaunch": "true",
                "Tags": [
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackName"
                        }
                    },
                    {
                        "Key": "Network",
                        "Value": "Public"
                    },
                    {
                        "Key": "Name",
                        "Value": "Public"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "39e32367-dc13-4ac5-b351-2dbcdd330dd5"
                }
            }
        },
        "rPrivateSubnet1": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "CidrBlock": {
                    "Ref": "pPrivateWebSubnetCIDRAZ1"
                },
                "AvailabilityZone": {
                    "Fn::Select": [
                        "0",
                        {
                            "Fn::GetAZs": ""
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackName"
                        }
                    },
                    {
                        "Key": "Network",
                        "Value": "Private"
                    },
                    {
                        "Key": "Name",
                        "Value": "Private"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "d499f116-9a15-4ffe-9611-89cb8a0e8f60"
                }
            }
        },
        "rPrivateSubnet2": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "CidrBlock": {
                    "Ref": "pPrivateWebSubnetCIDRAZ2"
                },
                "AvailabilityZone": {
                    "Fn::Select": [
                        "1",
                        {
                            "Fn::GetAZs": ""
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackName"
                        }
                    },
                    {
                        "Key": "Network",
                        "Value": "Private"
                    },
                    {
                        "Key": "Name",
                        "Value": "Private"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "0861c8d3-5aab-480d-a16e-d061516dae54"
                }
            }
        },
        "InternetGateway": {
            "Type": "AWS::EC2::InternetGateway",
            "Properties": {
                "Tags": [
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackName"
                        }
                    },
                    {
                        "Key": "Network",
                        "Value": "Public"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "a1849f4f-1fbd-47c4-9f24-d91bdafc9a55"
                }
            }
        },
        "GatewayToInternet": {
            "Type": "AWS::EC2::VPCGatewayAttachment",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "InternetGatewayId": {
                    "Ref": "InternetGateway"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "a0a05751-f344-4423-b6fe-b5833fb2360f"
                }
            }
        },
        "PublicRouteTable": {
            "Type": "AWS::EC2::RouteTable",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "Tags": [
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackName"
                        }
                    },
                    {
                        "Key": "Network",
                        "Value": "Public"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "9a01720a-66ac-462b-bc9c-391f7ecf749c"
                }
            }
        },
        "PublicRoute": {
            "Type": "AWS::EC2::Route",
            "DependsOn": "GatewayToInternet",
            "Properties": {
                "RouteTableId": {
                    "Ref": "PublicRouteTable"
                },
                "DestinationCidrBlock": "0.0.0.0/0",
                "GatewayId": {
                    "Ref": "InternetGateway"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "194e767c-f52b-43ef-b236-f41c59f2c4ca"
                }
            }
        },
        "PublicSubnetRouteTableAssociation1": {
            "Type": "AWS::EC2::SubnetRouteTableAssociation",
            "Properties": {
                "SubnetId": {
                    "Ref": "rPublicSubnet1"
                },
                "RouteTableId": {
                    "Ref": "PublicRouteTable"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "b3f5276c-7006-4cf8-a701-0f84df897582"
                }
            }
        },
        "PublicSubnetRouteTableAssociation2": {
            "Type": "AWS::EC2::SubnetRouteTableAssociation",
            "Properties": {
                "SubnetId": {
                    "Ref": "rPublicSubnet2"
                },
                "RouteTableId": {
                    "Ref": "PublicRouteTable"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "745a0cae-4fd1-4203-b374-4a93f94fb81b"
                }
            }
        },
        "PublicNetworkAcl": {
            "Type": "AWS::EC2::NetworkAcl",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "Tags": [
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackName"
                        }
                    },
                    {
                        "Key": "Network",
                        "Value": "Public"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "b10a1362-1f9e-40fb-83f8-bfc6e447ff1f"
                }
            }
        },
        "InboundHTTPPublicNetworkAclEntry": {
            "Type": "AWS::EC2::NetworkAclEntry",
            "Properties": {
                "NetworkAclId": {
                    "Ref": "PublicNetworkAcl"
                },
                "RuleNumber": "100",
                "Protocol": "-1",
                "RuleAction": "allow",
                "Egress": "false",
                "CidrBlock": "0.0.0.0/0",
                "PortRange": {
                    "From": "0",
                    "To": "65535"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "5c78b6a0-ee39-4b7f-97d3-96df1688f4cc"
                }
            }
        },
        "OutboundPublicNetworkAclEntry": {
            "Type": "AWS::EC2::NetworkAclEntry",
            "Properties": {
                "NetworkAclId": {
                    "Ref": "PublicNetworkAcl"
                },
                "RuleNumber": "100",
                "Protocol": "-1",
                "RuleAction": "allow",
                "Egress": "true",
                "CidrBlock": "0.0.0.0/0",
                "PortRange": {
                    "From": "0",
                    "To": "65535"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "0bd26bb5-d9b2-46c0-8e63-fc8dcbd53953"
                }
            }
        },
        "PublicSubnetNetworkAclAssociation1": {
            "Type": "AWS::EC2::SubnetNetworkAclAssociation",
            "Properties": {
                "SubnetId": {
                    "Ref": "rPublicSubnet1"
                },
                "NetworkAclId": {
                    "Ref": "PublicNetworkAcl"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "ece44d20-1834-4ea5-9b0a-ff4b86decc26"
                }
            }
        },
        "PublicSubnetNetworkAclAssociation2": {
            "Type": "AWS::EC2::SubnetNetworkAclAssociation",
            "Properties": {
                "SubnetId": {
                    "Ref": "rPublicSubnet2"
                },
                "NetworkAclId": {
                    "Ref": "PublicNetworkAcl"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "1f90314b-4c02-4191-907e-e14bb2ac6484"
                }
            }
        },
        "NATGateway": {
            "Type": "AWS::EC2::NatGateway",
            "Properties": {
                "AllocationId": {
                    "Fn::GetAtt": [
                        "ElasticIP",
                        "AllocationId"
                    ]
                },
                "SubnetId": {
                    "Ref": "rPublicSubnet1"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "524f11c0-1cf7-4b5f-838c-7ef3da15e6f2"
                }
            }
        },
        "ElasticIP": {
            "Type": "AWS::EC2::EIP",
            "Properties": {
                "Domain": "vpc"
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "d5d3ebe5-2659-4545-9d70-a0f53f4d14a6"
                }
            }
        },
        "PrivateRouteTable": {
            "Type": "AWS::EC2::RouteTable",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "3c2804fd-0f9c-42a2-98f0-b777a77b32ad"
                }
            }
        },
        "PrivateRouteToInternet": {
            "Type": "AWS::EC2::Route",
            "Properties": {
                "RouteTableId": {
                    "Ref": "PrivateRouteTable"
                },
                "DestinationCidrBlock": "0.0.0.0/0",
                "NatGatewayId": {
                    "Ref": "NATGateway"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "55c8f98e-4caa-4519-ac58-f653124a4089"
                }
            }
        },
        "PrivateSubnetRouteTableAssociation1": {
            "Type": "AWS::EC2::SubnetRouteTableAssociation",
            "Properties": {
                "SubnetId": {
                    "Ref": "rPrivateSubnet1"
                },
                "RouteTableId": {
                    "Ref": "PrivateRouteTable"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "82db69c9-b73b-4d6a-868b-fbf8d558a97b"
                }
            }
        },
        "PrivateSubnetRouteTableAssociation2": {
            "Type": "AWS::EC2::SubnetRouteTableAssociation",
            "Properties": {
                "SubnetId": {
                    "Ref": "rPrivateSubnet2"
                },
                "RouteTableId": {
                    "Ref": "PrivateRouteTable"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "fd8d23df-4577-4742-8372-5cdaefc709f3"
                }
            }
        },
        "rS3Bucket": {
            "Type": "AWS::S3::Bucket",
            "Properties": {
                "BucketName": {
                    "Ref": "pBucketName"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "69047e79-d274-47e8-9428-7c3e9d694a75"
                }
            }
        },
        "rCentricaBastionServerAZ1": {
            "DependsOn": [
                "rCentricaBastionSecurityGroup"
            ],
            "Type": "AWS::EC2::Instance",
            "Properties": {
                "AvailabilityZones": {
                    "Fn::GetAZs": "0"
                },
                "ImageId": {
                    "Ref": "pBastionAMIid"
                },
                "InstanceType": {
                    "Ref": "pBastionInstanceType"
                },
                "KeyName": {
                    "Ref": "pBastionKeyName"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "CentricaastionServer"
                    }
                ],
                "NetworkInterfaces": [
                    {
                        "AssociatePublicIpAddress": "true",
                        "DeviceIndex": "0",
                        "GroupSet": [
                            {
                                "Ref": "rCentricaBastionSecurityGroup"
                            }
                        ],
                        "SubnetId": {
                            "Ref": "rPublicSubnet1"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "e9cccca4-fb40-4cb2-8d0c-37fa7b24b166"
                }
            }
        },
        "rCentricaBastionServerAZ2": {
            "DependsOn": [
                "rCentricaBastionSecurityGroup"
            ],
            "Type": "AWS::EC2::Instance",
            "Properties": {
                "AvailabilityZones": {
                    "Fn::GetAZs": "1"
                },
                "ImageId": {
                    "Ref": "pBastionAMIid"
                },
                "InstanceType": {
                    "Ref": "pBastionInstanceType"
                },
                "KeyName": {
                    "Ref": "pBastionKeyName"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "CentricaastionServer"
                    }
                ],
                "NetworkInterfaces": [
                    {
                        "AssociatePublicIpAddress": "true",
                        "DeviceIndex": "0",
                        "GroupSet": [
                            {
                                "Ref": "rCentricaBastionSecurityGroup"
                            }
                        ],
                        "SubnetId": {
                            "Ref": "rPublicSubnet2"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "5dc23e19-b69c-43d0-96f6-124708677daf"
                }
            }
        },
        "rCentricaBastionSecurityGroup": {
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": {
                "GroupDescription": "Enable RDP access via port 3389",
                "SecurityGroupIngress": [
                    {
                        "CidrIp": {
                            "Ref": "pRDPLocation"
                        },
                        "FromPort": "3389",
                        "IpProtocol": "tcp",
                        "ToPort": "3389"
                    }
                ],
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "CentricaBastionSecurityGroup"
                    }
                ],
                "VpcId": {
                    "Ref": "VPC"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "ff65eadf-46f2-4d51-a0e4-e5a5fbdec593"
                }
            }
        },
        "rElasticLoadBalancer": {
            "Type": "AWS::ElasticLoadBalancing::LoadBalancer",
            "Properties": {
                "AvailabilityZones": {
                    "Fn::GetAZs": ""
                },
                "Instances": [
                    {
                        "Ref": "rCentricaBastionServerAZ1"
                    },
                    {
                        "Ref": "rCentricaBastionServerAZ2"
                    }
                ],
                "Listeners": [
                    {
                        "LoadBalancerPort": "80",
                        "InstancePort": {
                            "Ref": "pMasterport"
                        },
                        "Protocol": "HTTP"
                    }
                ],
                "HealthCheck": {
                    "Target": {
                        "Fn::Join": [
                            "",
                            [
                                "HTTP:",
                                {
                                    "Ref": "pMasterport"
                                },
                                "/"
                            ]
                        ]
                    },
                    "HealthyThreshold": "3",
                    "UnhealthyThreshold": "5",
                    "Interval": "30",
                    "Timeout": "5"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "d92f7dab-2789-49ce-a13b-b1adc65f7303"
                }
            }
        },
        "rWebServerAutoScaleAZ1": {
            "Type": "AWS::AutoScaling::AutoScalingGroup",
            "Properties": {
                "AvailabilityZones": {
                    "Fn::GetAZs": "0"
                },
                "LaunchConfigurationName": {
                    "Ref": "rWebServerLaunchConfigAZ1"
                },
                "VPCZoneIdentifier": [
                    {
                        "Ref": "rPrivateSubnet1"
                    }
                ],
                "MinSize": "1",
                "MaxSize": "4",
                "DesiredCapacity": {
                    "Ref": "pClusterSize"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Ref": "AWS::StackName"
                        },
                        "PropagateAtLaunch": true
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "7fe820b8-4872-4e65-867f-f5121511bf1b"
                }
            }
        },
        "rWebServerLaunchConfigAZ1": {
            "Type": "AWS::AutoScaling::LaunchConfiguration",
            "Properties": {
                "SpotPrice": {
                    "Ref": "pSpotPrice"
                },
                "ImageId": {
                    "Ref": "pWebServerAMIid"
                },
                "InstanceType": {
                    "Ref": "pWebServerInstanceType"
                },
                "KeyName": {
                    "Ref": "pWebServerKeyName"
                },
                "SecurityGroups": [
                    {
                        "Ref": "rWebServerecurityGroup"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "ff8e7759-a16f-41ab-9c0e-d5a392110dd3"
                }
            }
        },
        "rWebServerAutoScaleAZ2": {
            "Type": "AWS::AutoScaling::AutoScalingGroup",
            "Properties": {
                "AvailabilityZones": {
                    "Fn::GetAZs": "1"
                },
                "LaunchConfigurationName": {
                    "Ref": "rWebServerLaunchConfigAZ2"
                },
                "VPCZoneIdentifier": [
                    {
                        "Ref": "rPrivateSubnet2"
                    }
                ],
                "MinSize": "1",
                "MaxSize": "4",
                "DesiredCapacity": {
                    "Ref": "pClusterSize"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Ref": "AWS::StackName"
                        },
                        "PropagateAtLaunch": true
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "8d50543b-e0de-4d77-a1b7-d3106890ae41"
                }
            }
        },
        "rWebServerLaunchConfigAZ2": {
            "Type": "AWS::AutoScaling::LaunchConfiguration",
            "Properties": {
                "SpotPrice": {
                    "Ref": "pSpotPrice"
                },
                "ImageId": {
                    "Ref": "pWebServerAMIid"
                },
                "InstanceType": {
                    "Ref": "pWebServerInstanceType"
                },
                "KeyName": {
                    "Ref": "pWebServerKeyName"
                },
                "SecurityGroups": [
                    {
                        "Ref": "rWebServerecurityGroup"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "7ed01856-456b-48d0-9cf8-aa7dcb800d0d"
                }
            }
        },
        "rWebServerecurityGroup": {
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": {
                "GroupDescription": "CoreOS SecurityGroup",
                "SecurityGroupIngress": [
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "22",
                        "ToPort": "22",
                        "CidrIp": "0.0.0.0/0"
                    }
                ],
                "VpcId": {
                    "Ref": "VPC"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "6cbf2456-360d-4b76-a1f2-e43e76beaf78"
                }
            }
        }
    },
    "Outputs": {
        "VPCId": {
            "Description": "VPCId of the newly created VPC",
            "Value": {
                "Ref": "VPC"
            },
            "Export": {
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "AWS::Region"
                            },
                            {
                                "Fn::Sub": "${AWS::StackName}"
                            },
                            "VPC"
                        ]
                    ]
                }
            }
        },
        "HadoopURL": {
            "Description": "URL of the sample website",
            "Value": {
                "Fn::Join": [
                    "",
                    [
                        "http://",
                        {
                            "Fn::GetAtt": [
                                "rElasticLoadBalancer",
                                "DNSName"
                            ]
                        }
                    ]
                ]
            }
        },
        "PublicSubnet": {
            "Description": "SubnetId of the public subnet",
            "Value": {
                "Ref": "rPublicSubnet1"
            },
            "Export": {
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "AWS::Region"
                            },
                            {
                                "Fn::Sub": "${AWS::StackName}"
                            },
                            "rPublicSubnet1"
                        ]
                    ]
                }
            }
        },
        "PrivateSubnet": {
            "Description": "SubnetId of the private subnet",
            "Value": {
                "Ref": "rPrivateSubnet1"
            },
            "Export": {
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "AWS::Region"
                            },
                            {
                                "Fn::Sub": "${AWS::StackName}"
                            },
                            "rPrivateSubnet1"
                        ]
                    ]
                }
            }
        },
        "DefaultSecurityGroup": {
            "Description": "DefaultSecurityGroup Id ",
            "Value": {
                "Fn::GetAtt": [
                    "VPC",
                    "DefaultSecurityGroup"
                ]
            },
            "Export": {
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "AWS::Region"
                            },
                            {
                                "Fn::Sub": "${AWS::StackName}"
                            },
                            "DefaultSecurityGroup"
                        ]
                    ]
                }
            }
        }
    }
}
